<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product | Faye’s Vintage</title>

  <style>
    :root{
      --bg:#fff9f0;
      --accent:#d6a24d;
      --accent-soft:#f7e5bb;
      --text:#2f2615;
      --muted:#8d7a5f;
      --border:#f0e2c8;
      --card:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      background:var(--bg);
      color:var(--text);
    }

    header{
      padding:16px;
      background:#fffdf7;
      border-bottom:1px solid var(--border);
    }
    .header-inner{
      max-width:900px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    h1{
      margin:0;
      font-size:18px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-family:Georgia,serif;
      white-space:nowrap;
    }
    .back-link{
      font-size:13px;
      color:var(--accent);
      text-decoration:none;
      white-space:nowrap;
    }

    .detail-section{
      max-width:900px;
      margin:24px auto;
      padding:0 16px 24px;
    }
    .detail-card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:0 10px 24px rgba(90,60,20,.12);
      padding:18px;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1.2fr);
      gap:18px;
      position:relative;
    }
    @media(max-width:700px){
      .detail-card{grid-template-columns:1fr;}
    }

    .detail-card.sold{filter:grayscale(.9);opacity:.75;}
    .detail-sold-ribbon{
      position:absolute;
      top:14px;
      left:-40px;
      transform:rotate(-45deg);
      background:linear-gradient(90deg,#c8a46d,#e4c98c);
      color:#fff;
      font-size:11px;
      padding:4px 40px;
      letter-spacing:.12em;
      text-transform:uppercase;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
      z-index:6;
      pointer-events:none;
    }

    .carousel{
      position:relative;
      width:100%;
      aspect-ratio:4/5;
      background:#f4e7cf;
      border-radius:12px;
      overflow:hidden;
      touch-action:pan-y;
    }
    .carousel img{width:100%;height:100%;object-fit:cover;display:block;}
    .carousel-nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:28px;height:28px;
      border-radius:999px;
      border:none;
      background:rgba(255,253,247,.9);
      box-shadow:0 4px 10px rgba(60,40,10,.25);
      cursor:pointer;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .carousel-nav.prev{left:10px;}
    .carousel-nav.next{right:10px;}

    .carousel-dots{
      display:flex;
      justify-content:center;
      gap:6px;
      margin-top:6px;
    }
    .dot{width:7px;height:7px;border-radius:999px;background:#e4d0a8;cursor:pointer;}
    .dot.active{background:var(--accent);}

    .detail-info-top{
      font-size:12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.14em;
      margin-bottom:6px;
    }
    .detail-name{font-size:18px;font-weight:600;margin-bottom:8px;}
    .detail-price-row{
      display:flex;
      align-items:baseline;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .detail-price{font-size:20px;font-weight:700;}
    .detail-tag{
      font-size:11px;
      padding:2px 10px;
      border-radius:999px;
      background:var(--accent-soft);
      color:var(--accent);
    }
    .detail-desc{
      font-size:13px;
      color:var(--muted);
      line-height:1.7;
      margin-bottom:16px;
    }
    .detail-meta{
      font-size:12px;
      color:var(--muted);
      line-height:1.6;
    }
    .contact-box{
      margin-top:12px;
      padding:10px 12px;
      background:#fff9f0;
      border-radius:8px;
      border:1px dashed var(--border);
      font-size:12px;
      color:var(--muted);
    }
    .contact-box b{color:var(--text);}
  </style>
<script>
window.GA_MEASUREMENT_ID = 'G-F8VH58SNN6';

function loadGA() {
  if (window.__gaLoaded) return;
  window.__gaLoaded = true;

  const s = document.createElement('script');
  s.async = true;
  s.src = 'https://www.googletagmanager.com/gtag/js?id=' + window.GA_MEASUREMENT_ID;
  document.head.appendChild(s);

  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  window.gtag = gtag;

  gtag('js', new Date());
  gtag('config', window.GA_MEASUREMENT_ID, { anonymize_ip: true });
}

function hasConsent() {
  return localStorage.getItem('ga_consent') === 'granted';
}
if (hasConsent()) loadGA();
</script>

</head>

<body>
<header>
  <div class="header-inner">
    <h1>Faye’s Vintage</h1>
    <a href="shop.html" class="back-link" id="back-link">← Back</a>
  </div>
</header>

<div class="detail-section">
  <div id="detail-container"></div>
</div>

<script>
  let currentLang = localStorage.getItem('fv_lang') || 'en';
  if (currentLang !== 'en' && currentLang !== 'hu') currentLang = 'en';
  document.documentElement.lang = currentLang;

  const i18nDetail = {
    en: {
      back: "← Back to product list",
      labels: { brand:"Brand", category:"Category", color:"Color", size:"Size", year:"Year", status:"Status" },
      gender: { women:"Women’s item", men:"Men’s item", unisex:"Unisex item" },
      contactBox: "For more details, contact Faye’s Vintage via <b>WhatsApp</b>.",
      tags: { Available:"Available", Reserved:"Reserved", Sold:"Sold", Archived:"Archived" },
      errors: { no_id:"No product ID found. Please go back to the product list.", not_found:"No matching product found.", load_fail:"Unable to load product details. Please try again later." }
    },
    hu: {
      back: "← Vissza a termékekhez",
      labels: { brand:"Márka", category:"Kategória", color:"Szín", size:"Méret", year:"Évjárat", status:"Állapot" },
      gender: { women:"Női termék", men:"Férfi termék", unisex:"Unisex termék" },
      contactBox: "További részletekért kérjük, WhatsAppon keressen minket.",
      tags: { Available:"Elérhető", Reserved:"Foglalt", Sold:"Eladva", Archived:"Archiválva" },
      errors: { no_id:"Nem található termékazonosító. Kérjük lépj vissza a terméklistához.", not_found:"Nem találtunk ilyen terméket.", load_fail:"A termék betöltése nem sikerült. Kérjük próbáld meg később." }
    }
  };

  function getMLText(field){
    if(!field) return '';
    if(typeof field === 'string') return field;
    return field[currentLang] || field.en || field.hu || '';
  }

  function formatPrice(v){
    if(v === undefined || v === null) return '';
    if(typeof v === 'string'){
      const s = v.trim();
      return s ? s : '';
    }
    if(typeof v === 'number') return '€ ' + v;
    try{
      const s = String(v).trim();
      return s ? s : '';
    }catch(e){
      return '';
    }
  }

	  // ✅ NEW: show EUR/HUF by language (manual, no conversion), keep backward-compat with old "price"
  function getDisplayPrice(item){
    const eurRaw = (item && (item.price_eur ?? '')) || '';
    const hufRaw = (item && (item.price_huf ?? '')) || '';

    const eur = (typeof eurRaw === 'number') ? String(eurRaw) : String(eurRaw).trim();
    const huf = (typeof hufRaw === 'number') ? String(hufRaw) : String(hufRaw).trim();

    if(currentLang === 'hu'){
      if(huf) return huf + ' Ft';
      if(eur) return '€ ' + eur;
      return formatPrice(item ? item.price : '');
    }else{
      if(eur) return '€ ' + eur;
      if(huf) return huf + ' Ft';
      return formatPrice(item ? item.price : '');
    }
  }


  function getTagLabel(tag){
    return i18nDetail[currentLang].tags[tag] || tag || '';
  }

  document.getElementById('back-link').textContent = i18nDetail[currentLang].back;

  const params = new URLSearchParams(window.location.search);
  const productId = params.get('id');
  const container = document.getElementById('detail-container');

  if(!productId){
    container.innerHTML = `<p style="font-size:13px;color:#9ca3af;">${i18nDetail[currentLang].errors.no_id}</p>`;
  }else{
    fetch('products.json')
      .then(r=>r.json())
      .then(data=>{
        const item = data.find(p=>p.id===productId);
        if(!item){
          container.innerHTML = `<p style="font-size:13px;color:#9ca3af;">${i18nDetail[currentLang].errors.not_found}</p>`;
          return;
        }
	// ===== GA4 view_item (after product loaded) =====
if (hasConsent() && typeof gtag === 'function') {
  try {
    const brandText = getMLText(item.brand) || item.brand || '';
    const nameText  = getMLText(item.name)  || item.name  || '';

    gtag('event', 'view_item', {
      items: [{
        item_id: item.id,
        item_name: nameText,
        item_brand: brandText,
        item_category: item.gender || undefined
      }]
    });
  } catch(e) {}
}
        const images = (item.images && item.images.length) ? item.images : [item.image];
        let idx = 0;

        const brandText = getMLText(item.brand) || item.brand || '';
        const nameText  = getMLText(item.name)  || item.name  || '';
        const descText  = getMLText(item.description) || item.description || '';
        const labels    = i18nDetail[currentLang].labels;
        const genderText = item.gender && i18nDetail[currentLang].gender[item.gender] ? i18nDetail[currentLang].gender[item.gender] : '';
        const tagLabel  = getTagLabel(item.tag);
        const isSold    = item.tag === 'Sold';
        const priceHtml = getDisplayPrice(item);

        container.innerHTML = `
          <div class="detail-card ${isSold ? 'sold' : ''}">
            ${isSold ? '<div class="detail-sold-ribbon">SOLD</div>' : ''}
            <div>
              <div class="carousel" id="carousel-box">
                <button class="carousel-nav prev" id="img-prev">‹</button>
                <img src="${images[0]}" id="main-img" alt="${nameText}">
                <button class="carousel-nav next" id="img-next">›</button>
              </div>
              <div class="carousel-dots" id="dots">
                ${images.map((_,i)=>`<span class="dot ${i===0?'active':''}" data-i="${i}"></span>`).join('')}
              </div>
            </div>

            <div>
              <div class="detail-info-top">${brandText}${genderText ? ' · ' + genderText.toUpperCase() : ''}</div>
              <div class="detail-name">${nameText}</div>

              <div class="detail-price-row">
                ${priceHtml ? `<div class="detail-price">${priceHtml}</div>` : ``}
                <div class="detail-tag">${tagLabel}</div>
              </div>

              <div class="detail-desc">${descText || ' '}</div>

              <div class="detail-meta">
                · ${labels.brand}: ${brandText || '—'}<br>
                · ${labels.category}: ${genderText || '—'}<br>
                · ${labels.color}: ${getMLText(item.color) || item.color || '—'}<br>
                · ${labels.size}: ${item.size || '—'}<br>
                · ${labels.year}: ${item.year || '—'}<br>
                · ${labels.status}: ${tagLabel}
              </div>

              <div class="contact-box">${i18nDetail[currentLang].contactBox}</div>
            </div>
          </div>
        `;

        const mainImg = document.getElementById('main-img');
        const dots = Array.from(document.querySelectorAll('.dot'));
        const prev = document.getElementById('img-prev');
        const next = document.getElementById('img-next');
        const box  = document.getElementById('carousel-box');

        function update(n){
          idx = n;
          mainImg.src = images[idx];
          dots.forEach((d,i)=>d.classList.toggle('active', i===idx));
        }

        prev.addEventListener('click',(e)=>{e.stopPropagation();update((idx-1+images.length)%images.length);});
        next.addEventListener('click',(e)=>{e.stopPropagation();update((idx+1)%images.length);});
        dots.forEach(d=>{
          d.addEventListener('click',()=>{
            const n = parseInt(d.dataset.i,10);
            if(!isNaN(n)) update(n);
          });
        });

        // swipe
        let sx=0, touching=false;
        box.addEventListener('touchstart',(e)=>{
          if(!e.touches||!e.touches.length) return;
          sx = e.touches[0].clientX; touching=true;
        },{passive:true});
        box.addEventListener('touchend',(e)=>{
          if(!touching) return;
          touching=false;
          if(!e.changedTouches||!e.changedTouches.length) return;
          const ex = e.changedTouches[0].clientX;
          const dx = ex - sx;
          if(dx > 40) update((idx-1+images.length)%images.length);
          else if(dx < -40) update((idx+1)%images.length);
        });
      })
      .catch(()=>{
        container.innerHTML = `<p style="font-size:13px;color:#9ca3af;">${i18nDetail[currentLang].errors.load_fail}</p>`;
      });
  }
</script>

</body>
</html>
